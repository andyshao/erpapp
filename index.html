<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>首页</title>		
		<link href="themes/css/mui.min.css" rel="stylesheet" />
		<link href="themes/css/app.css" rel="stylesheet" />
	</head>

	<body>
		<div id="app">
			<div class="in_header">
				<div class="in_top">
					<p id="shopnames">{{model.shopName}}</p><span><i class="fa fa-envelope-o"></i></span>
				</div>
				<div class="in_sys" @click="goScanCode(0)">
					<img src="themes/img/icon/1_03.png">
				</div>
				<div class="foot mui-clearfix">
					<span class="span_th" @click="goScanCode(3)"><i class="mui-icon mui-icon-loop"></i>退货</span>
					<span class="span_fh" @click="goPage('返货管理','retnrulog','stock/return-log.html')"><i class="mui-icon mui-icon-undo"></i>返货</span>
				</div>
			</div>
			<div class="in_ornum mui-clearfix">
				<div @click="goPageRbtn('营业额','daysale','sale/day.html')"><strong id="dayo">{{dayRes.orderSum}}</strong><br>今日订单</div>
				<div @click="goPageRbtn('营业额','daysale','sale/day.html')"><strong id="daym">￥{{dayRes.money}}</strong><br>今日营业额</div>
			</div>
			<div class="in_nav">
				<ul class="mui-table-view mui-grid-view mui-grid-9">
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goPageRbtn('销售管理','sale','sale/index.html')">
						<a href="javascript:void(0)">
							<img src="themes/img/icon/xiaoshou.png">
							<div class="mui-media-body">销售管理</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goPage('统计报表','report','sale/report.html')">
						<a href="javascript:void(0)">
							<img src="themes/img/icon/tongji.png">
							<div class="mui-media-body">统计报表</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goPage('库存盘点','inventory','sale/inventory.html')">
						<a href="javascript:void(0)">
							<img src="themes/img/icon/pandian.png">
							<div class="mui-media-body">库存盘点</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goPage('退货管理','backlog','stock/back-log.html')">
						<a href="javascript:void(0)">
							<img src="themes/img/icon/tuihuo.png">
							<div class="mui-media-body">退货管理</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goPage('返货管理','retnrulog','stock/return-log.html')">
						<a href="javascript:void(0)">
							<img src="themes/img/icon/fanhuo.png">
							<div class="mui-media-body">返货管理</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goPage('购物车','cart','sale/cart.html')">
						<a href="javascript:void(0)" id="homeCart">
							<img src="themes/img/icon/cart.png"><span class="mui-badge mui-badge-red" style="display: none;">0</span>
							<div class="mui-media-body">购物车</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goScanCode(4)">
						<a href="javascript:void(0)">
							<img src="themes/img/icon/cancip.png">
							<div class="mui-media-body">残次品销售</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goPage('进货日志','inlog','stock/inlog.html')">
						<a href="javascript:void(0)">
							<img src="themes/img/icon/jinhuolog.png">
							<div class="mui-media-body">进货日志</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goPage('进货盘点','incheck','stock/incheck.html')">
						<a href="javascript:void(0)">
							<img src="themes/img/icon/jinhuopand.png">
							<div class="mui-media-body">进货盘点</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goPage('店员管理','staffindex','staff/index.html')">
						<a href="javascript:void(0)">
							<img src="themes/img/icon/dianyuan.png">
							<div class="mui-media-body">店员管理</div>
						</a>
					</li>				
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goPage('会员管理','memindex','member/index.html')">
						<a href="javascript:void(0)">
							<img src="themes/img/icon/huiyuan.png">
							<div class="mui-media-body">会员管理</div>
						</a>
					</li>
					<li class="mui-table-view-cell mui-media mui-col-xs-4 mui-col-sm-3" @click="goPage('系统设置','setindex','setup/index.html')">
						<a href="javascript:void(0)">
							<img src="themes/img/icon/shezhi.png">
							<div class="mui-media-body">系统设置</div>
						</a>
					</li>
				</ul>
			</div>
		</div>		
		<script src="themes/js/mui.min.js"></script>
		<script src="themes/js/vue.js"></script>
		<script src="themes/js/app.js"></script>
		<script type="text/javascript" charset="utf-8">
			mui.init();
			var _self=null,userModel = GetSession('$LoginUser');
			mui.plusReady(function() {
				//SessionRemove('$SaleCart');
				plusReady();
				os.dayInit();
				if(userModel == null) {
					mui.openWindow({ 
						url: 'login.html',
						id: 'login',
						show: {
							event: "loaded"
						},
						waiting: {
							autoShow: false
						}
					});
				} else {
					plus.navigator.closeSplashscreen();
					os.init();
				}
				window.addEventListener('loginSuccess',function(event){
				   os.init();
				})
			});
			var os={
				dayInit:function(){
					if(userModel==null){return;}
					vm.parm.guid = userModel.shopGuid;			
					baseAjax('/app/api/stock/turnover',vm.parm,function(res){
						if(res.statusCode==200){
							vm.dayRes=res.data;
						}else{
							mui.toast(res.message);
						}
						if(_self!=null){
							_self.endPullToRefresh();
						}
					});
				},
				init:function(){
					userModel = GetSession('$LoginUser');
					if(userModel==null)return;
					vm.model=userModel;
				}
			};
			var vm = new Vue({
				el: "#app",
				data:{
					model:{},
					dayRes:{
						orderSum:0,
						money:0
					},
					parm: {
						page:1,
						guid: '',
						types: 1
					},
				},
				created: function() {
					var that=this;
					if(userModel!=null){
						this.parm.guid = userModel.shopGuid;					
					}
				},
				methods:{
					goPage:function(title,id,url){
						goWin(id,url,title);
					},
					goPageRbtn:function(title,id,url){
						goWinRbtn(id,url,title,function(){
							var ws= plus.webview.getWebviewById(id);
							mui.fire(ws,'customEvent');
						},'\ue466');
					},
					/*
					 0=销售 1=进货盘点  2=返货  3=退货  4=残次品销售
					 * */
					goScanCode:function(t){
						SetSession('$barcode',{type:t,code:''});
						mui.openWindow({
							url: 'sale/barcode.html',
							id: 'barcode',
							show: {
								event: "loaded"
							},
							waiting: {
								autoShow: false
							}
						});
					},
					/*
					 * 返货  去往返货清单
					 */
					goReturn:function(){
						goWinRbtn('returnorder','sale/return-order.html','返货清单',function(){
							var ws= plus.webview.getWebviewById('returnorder');
							mui.fire(ws,'customEvent');
						},'\ue409');
					}
				}
			});
			function plusReady() {
							_self = plus.webview.currentWebview();
							_self.setPullToRefresh({
								support: true,
								height: '50px',
								range: '150px',
								style: 'circle',
								offset: '200px'
							}, pulldownRefresh);
						}
			
						function pulldownRefresh() {
							setTimeout(function() {
								os.dayInit();
							}, 500);
						}
		</script>
	</body>

</html>