<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>小票打印</title>
		<link href="../themes/css/mui.min.css" rel="stylesheet" />
		<link href="../themes/css/app.css" rel="stylesheet" />
	</head>
	<body class="mui-body">
		<div id="app">
			<div class="print_wall">
				<p id="p1">日期：{{model.time}}</p>
				<p id="p2">收款员：{{model.adminName}}</p>
				<p id="p3">订单号：{{order.number}}</p>
				<hr>
				<p>订单详情：</p>
				<table>
					<tr>
						<th>商品名</th>
						<th>金额</th>
					</tr>
					<tbody id="tsh">
						<tr class="p10" v-for="it in order.list" v-cloak>
							<td>{{it.goodName}}</td>
							<td>{{it.goodMoney}}</td>
						</tr>
						<tr><td colspan="2"></td></tr>
					</tbody>
					
				</table>
				<hr>
				<table>
					<tr>
						<td>数量</td>
						<td id="p4">{{model.counts}}</td>
					</tr>
					<tr>
						<td>付款总额</td>
						<td id="p5">{{model.money}}</td>
					</tr>
				</table>
			</div>
			<div class="barcode-foot mui-clearfix">
				<button type="button" @click="connectPrint" class="mui-btn mui-btn-danger">连接打印机</button>
				<button type="button" @click="prints" class="mui-btn mui-btn-danger">打印小票</button>
			</div>
		</div>
		<script src="../themes/js/mui.min.js"></script>
		<script src="../themes/js/zepto.min.js"></script>
		<script src="../themes/js/vue.js"></script>
		<script src="../themes/js/app.js"></script>
		<script>
			var userModel = GetSession('$LoginUser'),vm = new Vue({
				el: "#app",
				data: {
					model:{},
					list:[],
					order:{}
				},
				created: function () {
					var that=this;	
					this.order=GetSession('$SaleOrder');
					baseAjax('app/api/sale/bynumber',{number:this.order.number},function(res){
						if(res.statusCode==200){
							that.model=res.data;
							that.model.time=getNowFormatDate();
							that.model.adminName=userModel.adminName;
						}else{
							mui.toast(res.message);
						}
					});
				},
				methods: {
					prints:function(){
						mui.toast('打印小票');
					},
					connectPrint:function(){
						mui.toast('连接打印机');
					}
				}
			});	
			mui.init({
				swipeBack:true
			});
			//重写返回键
			mui.back=function(){
				var wsbar = plus.webview.getWebviewById('barcode');
				if(wsbar!=null){
					wsbar.close();
				}	
				var wsgood = plus.webview.getWebviewById('goods');
				if(wsgood!=null){
					wsgood.close();
				}
				var wsinput = plus.webview.getWebviewById('manualInput');
				if(wsinput!=null){
					wsinput.close();
				}
				var wc=plus.webview.currentWebview();
    			wc.close();
			}
		</script>
	</body>
</html>
