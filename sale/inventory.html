<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>盘点</title>
		<link href="../themes/css/mui.min.css" rel="stylesheet" />
		<link href="../themes/css/swiper-4.3.3.min.css" rel="stylesheet" />
		<link href="../themes/css/app.css" rel="stylesheet" />
		<style>
			html,
			body,#app {
				position: relative;
				height: 100%;
			}
			
			html {
				overflow: hidden;
			}
		</style>
	</head>

	<body>
		<div id="app">
			<div id="top" class="fyt-cus-swiper">
				<div class="swiper-container" id="nav">
					<div class="swiper-wrapper">
						<div class="swiper-slide">
							<span style="color: rgb(255, 80, 83)">今日盘点</span>
						</div>
						<div class="swiper-slide">
							<span>本月盘点</span>
						</div>							
						<div id="bar" class="bar">
							<div class="color"></div>
						</div>
					</div>					
				</div>
				<div class="fyt-slide" @click="wheres"><span>筛选</span></div>
			</div>
			<div class="swiper-container" id="page">
				<div class="swiper-wrapper">
					<div class="swiper-slide slidepage">
						<div style="height: 100px;">a</div>
						<div style="height: 100px;">a</div>
						<div style="height: 100px;">a</div>
						<div style="height: 100px;">a</div>
						<div style="height: 100px;">a</div>
						<div style="height: 100px;">a</div>
						<div style="height: 100px;">a</div>
						<div style="height: 100px;">a</div>
						<div style="height: 100px;">a</div>
						<div style="height: 100px;">a</div>
					</div>
					<div class="swiper-slide slidepage">
						<div style="height: 100px;">a</div>
					</div>
				</div>
			</div>
		</div>
		<script src="../themes/js/mui.min.js"></script>
		<script src="../themes/js/swiper-4.3.3.min.js"></script>
		<script src="../themes/js/vue.js"></script>
		<script src="../themes/js/app.js"></script>
		<script>
			mui.init();
			var vm = new Vue({
				el: "#app",
				data: {

				},
				methods: {
					wheres:function(){
						var winw=document.body.clientWidth;
						winw=winw-winw/3-10;
						document.getElementById('bar').style.transform ='translateX('+winw+'px)';
						mui("#nav .swiper-slide").each(function () {	
							this.find('span').css('color', 'rgba(51,51,51,1)');						  
						});
					}
				}
			});
			barwidth = 60 //导航粉色条的长度px
			tSpeed = 300 //切换速度300ms
			var navSwiper = new Swiper('#nav', {
				slidesPerView: 3,
				freeMode: true,
				on: {
					init: function() {
						navSlideWidth = this.slides.eq(0).css('width'); //导航字数需要统一,每个导航宽度一致
						bar = this.$el.find('.bar')
						bar.css('width', navSlideWidth)
						bar.transition(tSpeed)
						navSum = this.slides[this.slides.length - 1].offsetLeft //最后一个slide的位置

						clientWidth = parseInt(this.$wrapperEl.css('width')) //Nav的可视宽度
						navWidth = 0
						for(i = 0; i < this.slides.length; i++) {
							navWidth += parseInt(this.slides.eq(i).css('width'))
						}

						topBar = this.$el.parents('body').find('#top') //页头

					},

				},
			});

			var pageSwiper = new Swiper('#page', {
				watchSlidesProgress: true,
				resistanceRatio: 0,
				on: {
					touchMove: function() {
						progress = this.progress
						bar.transition(0)
						bar.transform('translateX(' + navSum * progress + 'px)')
						//粉色255,72,145灰色51,51,51
						for(i = 0; i < this.slides.length; i++) {
							slideProgress = this.slides[i].progress
							if(Math.abs(slideProgress) < 1) {
								r = Math.floor((255 - 51) * (1 - Math.pow(Math.abs(slideProgress), 2)) + 51)
								g = Math.floor((72 - 51) * (1 - Math.pow(Math.abs(slideProgress), 2)) + 51)
								b = Math.floor((145 - 51) * (1 - Math.pow(Math.abs(slideProgress), 2)) + 51)
								navSwiper.slides.eq(i).find('span').css('color', 'rgba(' + r + ',' + g + ',' + b + ',1)')
							}
						}
					},
					transitionStart: function() {
						activeIndex = this.activeIndex
						activeSlidePosition = navSwiper.slides[activeIndex].offsetLeft
						//释放时导航粉色条移动过渡
						bar.transition(tSpeed)
						bar.transform('translateX(' + activeSlidePosition + 'px)')
						//释放时文字变色过渡
						navSwiper.slides.eq(activeIndex).find('span').transition(tSpeed)
						navSwiper.slides.eq(activeIndex).find('span').css('color', 'rgba(255,80,83,1)')
						if(activeIndex > 0) {
							navSwiper.slides.eq(activeIndex - 1).find('span').transition(tSpeed)
							navSwiper.slides.eq(activeIndex - 1).find('span').css('color', 'rgba(51,51,51,1)')
						}
						if(activeIndex < this.slides.length) {
							navSwiper.slides.eq(activeIndex + 1).find('span').transition(tSpeed)
							navSwiper.slides.eq(activeIndex + 1).find('span').css('color', 'rgba(51,51,51,1)')
						}
						//导航居中
						navActiveSlideLeft = navSwiper.slides[activeIndex].offsetLeft //activeSlide距左边的距离

						navSwiper.setTransition(tSpeed)
						if(navActiveSlideLeft < (clientWidth - parseInt(navSlideWidth)) / 2) {
							navSwiper.setTranslate(0)
						} else if(navActiveSlideLeft > navWidth - (parseInt(navSlideWidth) + clientWidth) / 2) {
							//navSwiper.setTranslate(clientWidth - navWidth)
						} else {
							//navSwiper.setTranslate((clientWidth - parseInt(navSlideWidth)) / 2 - navActiveSlideLeft)
						}

					},
				}
			});

			navSwiper.$el.on('touchstart', function(e) {
				e.preventDefault() //去掉按压阴影
			})
			navSwiper.on('tap', function(e) {
				clickIndex = this.clickedIndex
				clickSlide = this.slides.eq(clickIndex)
				pageSwiper.slideTo(clickIndex, 0);
				this.slides.find('span').css('color', 'rgba(51,51,51,1)');
				clickSlide.find('span').css('color', 'rgba(255,80,83,1)');
			})

		</script>
	</body>

</html>